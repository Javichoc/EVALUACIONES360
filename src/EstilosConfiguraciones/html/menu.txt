

<style>
    .navbar {
        /* width: 99.8vw; */
        margin: auto;
        background: #222;
    }

    .dropdown-submenu {
        position: relative;
    }

    .dropdown-submenu a::after {
        transform: rotate(-90deg);
        position: absolute;
        right: 6px;
        top: .8em;
    }

    .dropdown-submenu .dropdown-menu {
        top: 0;
        left: 100%;
        margin-left: .1rem;
        margin-right: .1rem;
    }



    .navbar-light .navbar-nav .nav-link {
        color: #fff !important;
        font-weight: bold;
        padding: 1rem !important;
    }

    .navbar-light .navbar-nav .nav-link:hover {
        color: #fff !important;
        background: #080808;
    }




    @media only screen and (min-width: 997px) {}

    .btn-hamburger {
        color: #fff !important;
    }

    .btn-hamburger:hover {
        background-color: #222B60 !important;
        color: #fff !important;
    }

    .navbar-light .navbar-toggler {
        border-color: transparent !important;
    }

    .btn-hamburger:focus {
        outline: none !important;
    }

    .dropdown-item {
        /* color: #fff !important; */
        padding: .5rem 1.5rem !important;
    }



    .dropdown-submenu a::after {
        top: 1.1em !important;
    }

    .nav-item .nav-link {
        font-size: 14px !important;
        font-weight: 500;
    }
</style>
<div class="container-fluid">
    <nav class="navbar navbar-expand-lg navbar-light nav-cls py-lg-0 py-sm-3 rounded">
        <button class="navbar-toggler btn-hamburger text-white" type="button" data-toggle="collapse"
            data-target="#navbarTogglerDemo01" aria-controls="navbarTogglerDemo01" aria-expanded="false"
            aria-label="Toggle navigation">
            <i class="fas fa-bars"></i>
        </button>
        <div class="collapse navbar-collapse justify-content-lg-between" id="navbarTogglerDemo01">
            <!-- <a class="navbar-brand pr-5 pl-2"
                href="https://gruposuperior.sharepoint.com/sites/Mired_Superior/SitePages/Portal.aspx">
                <img src="https://gruposuperior.sharepoint.com/sites/Mired_Superior/CSImagenesPortal/LOGO%20JUNTOS-07.png"
                    alt=""></a> -->

            <ul class="navbar-nav mt-2 mt-lg-0 mx-auto" id="ulHeader">
                <!--  <li class="nav-item active">
                    <a class="nav-link" href="#">Home <span class="sr-only">(current)</span></a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="#">Link</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link disabled" href="#">Disabled</a>
                </li>
                <li class="nav-item dropdown">
                    <a class="nav-link dropdown-toggle" href="# " id="navbarDropdownMenuLink" data-toggle="dropdown"
                        aria-haspopup="true" aria-expanded="false">
                        Dropdown link
                    </a>
                    <ul class="dropdown-menu" aria-labelledby="navbarDropdownMenuLink">
                        <li><a class="dropdown-item" href="#">Action</a></li>
                        <li><a class="dropdown-item" href="#">Another action</a></li>
                        <li class="dropdown-submenu"><a class="dropdown-item dropdown-toggle" href="#">Submenu</a>
                            <ul class="dropdown-menu">
                                <li><a class="dropdown-item" href="#">Submenu action</a></li>
                                <li><a class="dropdown-item" href="#">Another submenu action</a></li>
    
    
                                <li class="dropdown-submenu"><a class="dropdown-item dropdown-toggle"
                                        href="#">Subsubmenu</a>
                                    <ul class="dropdown-menu">
                                        <li><a class="dropdown-item" href="#">Subsubmenu action</a></li>
                                        <li><a class="dropdown-item" href="#">Another subsubmenu action</a></li>
                                    </ul>
                                </li>
                                <li class="dropdown-submenu"><a class="dropdown-item dropdown-toggle" href="#">Second
                                        subsubmenu</a>
                                    <ul class="dropdown-menu">
                                        <li><a class="dropdown-item" href="#">Subsubmenu action</a></li>
                                        <li><a class="dropdown-item" href="#">Another subsubmenu action</a></li>
                                    </ul>
                                </li>
    
    
    
                            </ul>
                        </li>
                    </ul>
                </li>
    
                <li class="nav-item dropdown">
                    <a class="nav-link dropdown-toggle" href="# " id="navbarDropdownMenuLink2" data-toggle="dropdown"
                        aria-haspopup="true" aria-expanded="false">
                        Dropdown link 2
                    </a>
                    <ul class="dropdown-menu" aria-labelledby="navbarDropdownMenuLink2">
                        <li><a class="dropdown-item" href="#">Action</a></li>
                        <li><a class="dropdown-item" href="#">Another action</a></li>
                        <li class="dropdown-submenu"><a class="dropdown-item dropdown-toggle" href="#">Submenu</a>
                            <ul class="dropdown-menu">
                                <li><a class="dropdown-item" href="#">Submenu action</a></li>
                                <li><a class="dropdown-item" href="#">Another submenu action</a></li>
    
    
                                <li class="dropdown-submenu"><a class="dropdown-item dropdown-toggle"
                                        href="#">Subsubmenu</a>
                                    <ul class="dropdown-menu">
                                        <li><a class="dropdown-item" href="#">Subsubmenu action</a></li>
                                        <li><a class="dropdown-item" href="#">Another subsubmenu action</a></li>
                                    </ul>
                                </li>
                                <li class="dropdown-submenu"><a class="dropdown-item dropdown-toggle" href="#">Second
                                        subsubmenu</a>
                                    <ul class="dropdown-menu">
                                        <li><a class="dropdown-item" href="#">Subsubmenu action</a></li>
                                        <li><a class="dropdown-item" href="#">Another subsubmenu action</a></li>
                                    </ul>
                                </li>
    
    
    
                            </ul>
                        </li>
                    </ul>
                </li> -->
            </ul>
        </div>
    </nav>
</div>


<script>

    var menu = []
    var subMenu = []
    var subMenu3 = []

    var esAdministrador = false

    function verificarAdministrador() {
        var idUser = _spPageContextInfo.userId
        var data = getDataSp({ listaNombre: 'Administradores', colums: '*,Colaborador/ID', filter: `Colaborador/ID eq ${idUser}`, expand: 'Colaborador', top: '1' })
        if (data.ok) {
            if (data.data.results.length > 0) {
                esAdministrador = true
            }
        }
    }


    function consultarMenu() {
        var data = getDataSp({ listaNombre: 'Menu', orderColum: 'Orden', orderType: 'asc' })
        if (data.ok) {
            menu = data.data.results
            menuDetalle = data.data.results
        }
    }

    function consultarSubMenu() {
        var data = getDataSp({ listaNombre: 'SubMenu', orderColum: 'Orden', orderType: 'asc' })
        if (data.ok) {
            subMenu = data.data.results
        }
    }

    function procesarMenu() {
        var html = ''
        /*  `<li><a href="#" onclick="buscarUrl(10)" >Inicio</li>`;*/
        menu.forEach(e => {
            var url = e.Url_Destino == null ? '#' : e.Url_Destino
            var title = e.Title == null ? '' : e.Title
            var sublinks = menuNivel2(e.ID)
            var attributos = sublinks ? `id="menu-${e.ID}" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false"` : ''
            
            var abrirOtraVentana = e.AbrirOtraVentana ==='SI'?`target="_blank"`:''
            
            if (e.Valida_Administrador && esAdministrador) {
                html += /* html */`<li class="nav-item ${sublinks ? 'dropdown' : ''}"><a class="nav-link ${sublinks ? 'dropdown-toggle' : ''}" ${abrirOtraVentana} href="${url}" ${attributos} >${title}</a>${sublinks}</li>`
            }
            if (!e.Valida_Administrador) {
                html += /* html */`<li class="nav-item ${sublinks ? 'dropdown' : ''}"><a class="nav-link ${sublinks ? 'dropdown-toggle' : ''}" ${abrirOtraVentana} href="${url}" ${attributos} >${title}</a>${sublinks}</li>`
            }
        })
        $('#ulHeader').html(html);
    }

    function menuNivel2(idMenu) {
        var subMenufilter = subMenu.filter(e => e.MenuId == idMenu)

        if (subMenufilter.length == 0) {
            return ''
        }

        var htmlSubMenus = ''
        subMenufilter.forEach(e => {
            var url = e.Url_Destino == null ? '#' : e.Url_Destino
            var title = e.Title == null ? '' : e.Title
            var abrirOtraVentana = e.AbrirOtraVentana ==='SI'?`target="_blank"`:''
            
            
            if (e.Valida_Administrador && esAdministrador) {
                htmlSubMenus += /* html */`<li ><a class="dropdown-item" ${abrirOtraVentana} href="${url}">${title}</a></li>`
            }
            if (!e.Valida_Administrador) {
                htmlSubMenus += /* html */`<li ><a class="dropdown-item" ${abrirOtraVentana} href="${url}">${title}</a></li>`
            }
        });
        return htmlSubMenus ? `<ul class="dropdown-menu" aria-labelledby="menu-${idMenu}">${htmlSubMenus}</ul>` : ''
    }


    function llenarMenuNav() {
        verificarAdministrador()
        consultarMenu()
        consultarSubMenu()
        procesarMenu()


        $('.dropdown-menu a.dropdown-toggle').on('click', function (e) {
            if (!$(this).next().hasClass('show')) {
                $(this).parents('.dropdown-menu').first().find('.show').removeClass("show");
            }
            var $subMenu = $(this).next(".dropdown-menu");
            $subMenu.toggleClass('show');


            $(this).parents('li.nav-item.dropdown.show').on('hidden.bs.dropdown', function (e) {
                $('.dropdown-submenu .show').removeClass("show");
            });


            return false;
        });
    }
    llenarMenuNav();
</script>